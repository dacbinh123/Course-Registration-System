<h2 class="chat-title">Trò chuyện với Admin</h2>

<div class="chat-container">
  <div id="chat-box" class="chat-box">
    {{#each messages}}
      <div class="message {{#if (eq this.sender.role 'admin')}}admin-message{{/if}}">
        <span class="sender">{{this.sender.name}}:</span>
        <p class="message-content">{{this.content}}</p>
      </div>
    {{/each}}
  </div>

  <form id="chat-form" class="chat-form">
    <input type="hidden" id="senderId" value="{{user._id}}" />
    <input type="hidden" id="receiverId" value="{{adminId}}" />
    <input type="text" id="message" class="input-field" placeholder="Nhập tin nhắn..." required />
    <button type="submit" class="send-button">Gửi</button>
  </form>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const chatForm = document.getElementById('chat-form');
  const chatBox = document.getElementById('chat-box');

  chatForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const senderId = document.getElementById('senderId').value;
    const receiverId = document.getElementById('receiverId').value;
    const message = document.getElementById('message').value;

    socket.emit('sendMessage', { sender: senderId, receiver: receiverId, content: message });
    document.getElementById('message').value = '';
  });

  socket.on('receiveMessage', (data) => {
    const isAdmin = data.senderRole === 'admin';
    const newMessage = `
      <div class="message ${isAdmin ? 'admin-message' : ''}">
        <span class="sender">${data.senderName}:</span>
        <p class="message-content">${data.content}</p>
      </div>`;
    chatBox.innerHTML += newMessage;
    chatBox.scrollTop = chatBox.scrollHeight; 
  });
</script>
